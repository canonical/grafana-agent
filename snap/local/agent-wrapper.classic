#!/bin/sh

if [ "$(snapctl get reporting-enabled)" = "0" ]
then
  echo "Launched with reporting disabled" | systemd-cat
  REPORTING_ARG="-disable-reporting"
else
  echo "Launched with reporting enabled" | systemd-cat
  REPORTING_ARG=""
fi

exec "${SNAP}/agent" -config.expand-env -config.file "/etc/grafana-agent.yaml" "${REPORTING_ARG}"
